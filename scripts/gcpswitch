#!/usr/bin/env zsh

if [ $# -eq 0 ]; then
  gcloud config configurations list
  exit 0
fi

project=$1
env=${2:-dev}
config_name="${project}-${env}"

if ! gcloud config configurations list --format='value(name)' | grep -q "^${config_name}$"; then
  echo "Error: Configuration '$config_name' not found"
  gcloud config configurations list --format='table(name)'
  exit 1
fi

echo "Switching to ${config_name}..."
gcloud config configurations activate "${config_name}" > /dev/null 2>&1

account=$(gcloud config get-value account 2>/dev/null)

gcloud auth login "${account}" --update-adc --brief

gcloud config configurations list --filter="IS_ACTIVE=True"
